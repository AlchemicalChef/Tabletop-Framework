import type { LibraryEntry } from '../library'

export const cisaRansomwareScenario: LibraryEntry = {
  id: 'cisa-ransomware-ctep-001',
  title: 'CISA CTEP: Ransomware Attack',
  category: 'ransomware',
  difficulty: 'intermediate',
  duration: 180,
  description: 'Based on the official CISA Cybersecurity Tabletop Exercise Package (CTEP). This scenario walks through a ransomware attack from initial CISA alerts through data exfiltration, ransomware deployment, dark web exposure, and media involvement. Designed for critical infrastructure organizations.',
  tags: ['ransomware', 'CISA', 'CTEP', 'critical-infrastructure', 'data-exfiltration', 'phishing', 'incident-response', 'NIST-CSF'],
  moduleCount: 2,
  injectCount: 8,
  questionCount: 17,
  scenario: {
    id: 'cisa-ransomware-ctep-001',
    title: 'CISA CTEP: Ransomware Attack',
    description: 'Based on the official CISA Cybersecurity Tabletop Exercise Package (CTEP). This scenario walks through a ransomware attack from initial CISA alerts through data exfiltration, ransomware deployment, dark web exposure, and media involvement.',
    version: '1.0.0',
    author: 'Keith',
    createdAt: '2024-09-01T00:00:00Z',
    updatedAt: '2024-09-01T00:00:00Z',
    threatCategory: 'ransomware',
    difficulty: 'intermediate',
    estimatedDuration: 180,
    targetAudience: ['IT Security', 'Executive Leadership', 'Legal/Compliance', 'Communications', 'Operations', 'Human Resources'],
    objectives: [
      'Examine current plans, policies, and procedures for responding to a ransomware attack',
      'Identify strengths and areas for improvement in incident response capabilities',
      'Practice coordination between technical, executive, and communications teams',
      'Understand the progression from initial compromise to full-scale ransomware deployment'
    ],
    facilitatorGuide: {
      id: 'fg-cisa-ransomware-ctep-001',
      createdAt: '2024-09-01T00:00:00Z',
      updatedAt: '2024-09-01T00:00:00Z',
      title: 'Facilitator Guide - CISA CTEP Ransomware',
      type: 'facilitator_guide',
      format: 'markdown',
      content: 'This exercise is based on CISA CTEP materials. Module 1 covers the pre-incident and initial detection phase (Days 1-6). Module 2 covers the active incident and response phase (Days 7-11). Encourage participants to discuss their actual policies and procedures rather than theoretical responses.'
    },
    additionalMaterials: [],
    settings: {
      allowParticipantSkip: false,
      requireAllResponses: true,
      showInjectTimestamps: true,
      enableAnonymousResponses: false
    },
    modules: [
      {
        id: 'cisa-ransomware-mod-1',
        createdAt: '2024-09-01T00:00:00Z',
        updatedAt: '2024-09-01T00:00:00Z',
        title: 'Module 1: Pre-Incident & Initial Detection',
        description: 'Initial indicators and early warning signs leading up to the ransomware attack.',
        phase: 'detection',
        order: 1,
        suggestedDuration: 90,
        facilitatorNotes: 'This module establishes the threat landscape and introduces early warning signs. Focus on how participants would handle each escalating situation.',
        injects: [
          {
            id: 'cisa-ransomware-inj-1-1',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 1,
            title: 'Day 1: CISA Ransomware Alert',
            content: 'CISA issues an Alert regarding a new ransomware variant targeting organizations in your sector. The alert indicates that threat actors are using spear phishing emails with malicious attachments to gain initial access. Once inside, they move laterally, exfiltrate sensitive data, and then deploy ransomware.\n\nThe alert recommends:\n- Review and update incident response plans\n- Ensure offline backups are current and tested\n- Implement network segmentation\n- Enable multi-factor authentication\n- Conduct user awareness training on phishing',
            type: 'information',
            severity: 'medium',
            triggerTime: 0,
            source: 'CISA Alert',
            facilitatorNotes: 'This sets the stage. Ask participants what actions they would take in response to this alert.',
            expectedActions: ['Review and distribute the alert internally', 'Verify backup status', 'Check for IOCs mentioned in the alert', 'Consider additional user training'],
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-1-1']
          },
          {
            id: 'cisa-ransomware-inj-1-2',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 2,
            title: 'Day 2: End-of-Life Systems Discovered',
            content: 'During a routine vulnerability scan, the IT team discovers that several systems are running end-of-life (EOL) operating systems that no longer receive security patches. These systems include:\n\n- 3 workstations in the Accounting department\n- 1 server hosting a legacy application\n- 2 workstations in the HR department with access to employee PII\n\nThe legacy application vendor has not yet released a compatible version for newer operating systems. Budget constraints have delayed planned upgrades.',
            type: 'information',
            severity: 'high',
            triggerTime: 10,
            source: 'IT Security Team',
            facilitatorNotes: 'This introduces a common organizational challenge - legacy systems with known vulnerabilities.',
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-1-2']
          },
          {
            id: 'cisa-ransomware-inj-1-3',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 3,
            title: 'Day 4: Employee Laptop Stolen',
            content: 'An employee reports that their work laptop was stolen from their vehicle over the weekend. The laptop contained:\n\n- Access credentials saved in the browser\n- VPN connection configured for remote access\n- Local copies of sensitive documents\n- Email with organizational information\n\nThe employee is unsure if the laptop was powered off and whether full-disk encryption was enabled. The laptop was last synced with corporate systems 3 days ago.',
            type: 'escalation',
            severity: 'high',
            triggerTime: 25,
            source: 'HR Department',
            facilitatorNotes: 'Physical security incident that could enable unauthorized access. Discuss credential reset, VPN access review, and device management policies.',
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-1-3']
          },
          {
            id: 'cisa-ransomware-inj-1-4',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 4,
            title: 'Day 6: Phishing Email to Finance',
            content: 'The Finance department receives a targeted phishing email that appears to be from a known vendor. The email contains a link to what looks like an invoice requiring immediate payment. Several employees report clicking the link before realizing it was suspicious.\n\nThe link directed users to a credential harvesting page that mimicked your organization\'s SSO login. At least 4 employees may have entered their credentials.\n\nEmail headers show the message originated from an external domain that closely resembles your vendor\'s actual domain (one character difference).',
            type: 'escalation',
            severity: 'critical',
            triggerTime: 40,
            source: 'Finance Department / IT Security',
            facilitatorNotes: 'This is the initial access vector. Multiple credentials may be compromised. Discuss immediate response actions.',
            expectedActions: ['Reset compromised credentials immediately', 'Block the malicious domain', 'Scan for additional phishing emails', 'Check for unauthorized access using compromised accounts'],
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-1-4', 'cisa-ransomware-q-1-8']
          }
        ],
        discussionQuestions: [
          {
            id: 'cisa-ransomware-q-1-1',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 1,
            question: 'What is your process for receiving, analyzing, and disseminating CISA alerts and other threat intelligence within your organization?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Look for established processes for threat intelligence consumption. Many organizations lack formal procedures for acting on external threat intelligence.',
            expectedThemes: ['Threat intelligence program', 'Alert distribution', 'Action item tracking', 'Communication channels']
          },
          {
            id: 'cisa-ransomware-q-1-2',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 2,
            question: 'How does your organization manage end-of-life systems? What compensating controls are in place when immediate replacement is not possible?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Common compensating controls include network isolation, enhanced monitoring, application whitelisting, and limiting user access.',
            expectedThemes: ['Asset inventory', 'Risk assessment', 'Compensating controls', 'Budget planning']
          },
          {
            id: 'cisa-ransomware-q-1-3',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 3,
            question: 'What is your incident response procedure when an employee device containing credentials and sensitive data is lost or stolen?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Key elements: immediate credential reset, remote wipe capability, access log review, encryption verification.',
            expectedThemes: ['Credential management', 'Remote wipe', 'Encryption policy', 'Access review']
          },
          {
            id: 'cisa-ransomware-q-1-4',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 4,
            question: 'How would you determine the scope of a phishing incident where multiple employees may have compromised their credentials?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Scope determination is critical. Discuss email log analysis, authentication logs, affected system identification.',
            expectedThemes: ['Email analysis', 'Authentication logs', 'User interviews', 'Scope determination']
          },
          {
            id: 'cisa-ransomware-q-1-5',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 5,
            question: 'At what point would you escalate this situation to executive leadership? What information would they need?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Escalation criteria vary by organization. Discuss thresholds, communication templates, and executive briefing formats.',
            expectedThemes: ['Escalation criteria', 'Executive communication', 'Decision support', 'Status reporting']
          },
          {
            id: 'cisa-ransomware-q-1-6',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 6,
            question: 'What external resources (law enforcement, CISA, sector ISACs) would you contact at this stage? What information sharing agreements do you have in place?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'Discuss relationships with FBI, CISA, sector ISACs. Many organizations wait too long to engage external resources.',
            expectedThemes: ['FBI/CISA engagement', 'ISAC membership', 'Information sharing', 'External partnerships']
          },
          {
            id: 'cisa-ransomware-q-1-7',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 7,
            question: 'How would you communicate with employees about an ongoing security incident without causing panic or tipping off the attacker?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Balance transparency with operational security. Discuss pre-approved messaging and communication channels.',
            expectedThemes: ['Internal communications', 'Operational security', 'Employee guidance', 'Messaging templates']
          },
          {
            id: 'cisa-ransomware-q-1-8',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 8,
            question: 'What training does your organization provide to help employees identify and report phishing attempts?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Discuss training frequency, phishing simulations, reporting mechanisms, and metrics for measuring effectiveness.',
            expectedThemes: ['Security awareness training', 'Phishing simulations', 'Reporting mechanisms', 'Training metrics']
          }
        ]
      },
      {
        id: 'cisa-ransomware-mod-2',
        createdAt: '2024-09-01T00:00:00Z',
        updatedAt: '2024-09-01T00:00:00Z',
        title: 'Module 2: Active Incident Response',
        description: 'The ransomware attack is discovered and the organization must respond to an active incident.',
        phase: 'containment',
        order: 2,
        suggestedDuration: 90,
        facilitatorNotes: 'This module covers the active incident phase. The situation escalates rapidly. Focus on decision-making under pressure and coordination between teams.',
        injects: [
          {
            id: 'cisa-ransomware-inj-2-1',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 1,
            title: 'Day 7: Anomalous DNS Traffic Detected',
            content: 'Network monitoring tools detect anomalous DNS traffic patterns. Analysis reveals:\n\n- Large volumes of DNS queries to previously unknown domains\n- Queries occurring at regular intervals suggesting automated activity\n- Traffic originating from multiple internal systems\n- Pattern consistent with data exfiltration via DNS tunneling\n\nPreliminary investigation suggests approximately 50GB of data may have been exfiltrated over the past 72 hours. The data appears to include files from network shares containing financial records and employee information.',
            type: 'escalation',
            severity: 'critical',
            triggerTime: 0,
            source: 'Security Operations Center',
            facilitatorNotes: 'Data exfiltration has already occurred. This changes the nature of the incident significantly.',
            expectedActions: ['Block identified malicious domains', 'Isolate affected systems', 'Begin forensic investigation', 'Assess data exposure'],
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-2-1']
          },
          {
            id: 'cisa-ransomware-inj-2-2',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 2,
            title: 'Day 9: Ransomware Deployed',
            content: 'At 3:47 AM, ransomware is deployed across the network. When employees arrive:\n\n- Workstations display ransom notes demanding $53,000 in cryptocurrency\n- File servers are encrypted, including backup servers on the network\n- Email systems are offline\n- Critical business applications are inaccessible\n- Phone systems (VoIP) are affected\n\nThe ransom note threatens to publish exfiltrated data on a dark web leak site if payment is not made within 72 hours. A countdown timer is displayed.\n\nOffline backups exist but are 2 weeks old.',
            type: 'escalation',
            severity: 'critical',
            triggerTime: 20,
            source: 'IT Operations',
            facilitatorNotes: 'This is the crisis point. Multiple systems affected, business operations disrupted, and a deadline imposed by the attackers.',
            expectedActions: ['Activate incident response plan', 'Assess scope of encryption', 'Evaluate backup viability', 'Consider engaging ransomware negotiation specialists'],
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-2-2', 'cisa-ransomware-q-2-3']
          },
          {
            id: 'cisa-ransomware-inj-2-3',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 3,
            title: 'Day 10: Dark Web Data Leak',
            content: 'A threat intelligence service alerts you that data from your organization has appeared on a known ransomware group\'s dark web leak site. The posted data includes:\n\n- Sample employee records including Social Security numbers\n- Financial documents and banking information\n- Internal emails discussing sensitive business matters\n- Customer/client information\n\nThe posting states this is a "sample" and the full data set will be released if ransom is not paid. The leak site has been indexed by search engines and news aggregators.',
            type: 'escalation',
            severity: 'critical',
            triggerTime: 40,
            source: 'Threat Intelligence / Legal',
            facilitatorNotes: 'The data breach is now public. This triggers notification requirements and potential regulatory scrutiny.',
            expectedActions: ['Engage legal counsel', 'Prepare breach notifications', 'Coordinate with PR/Communications', 'Contact affected individuals'],
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-2-4', 'cisa-ransomware-q-2-6']
          },
          {
            id: 'cisa-ransomware-inj-2-4',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 4,
            title: 'Day 11: Media Inquiries',
            content: 'A local news outlet contacts your communications department stating they are running a story about the "data breach" at your organization. They have obtained information from the dark web leak site and are asking for comment:\n\n- How many individuals are affected?\n- What data was compromised?\n- When did the breach occur and when was it discovered?\n- What is being done to protect affected individuals?\n- Will the organization pay the ransom?\n\nThey plan to run the story on the evening news broadcast.',
            type: 'communication',
            severity: 'high',
            triggerTime: 55,
            source: 'Communications Department',
            facilitatorNotes: 'Media involvement adds public pressure. Discuss crisis communications, spokesperson designation, and messaging coordination.',
            attachments: [],
            relatedQuestionIds: ['cisa-ransomware-q-2-5']
          }
        ],
        discussionQuestions: [
          {
            id: 'cisa-ransomware-q-2-1',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 1,
            question: 'Upon discovering data exfiltration, what is your process for determining what data was taken and its sensitivity level?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Discuss data classification, DLP tools, forensic analysis capabilities, and documentation requirements.',
            expectedThemes: ['Data classification', 'Forensic analysis', 'Log analysis', 'Scope determination']
          },
          {
            id: 'cisa-ransomware-q-2-2',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 2,
            question: 'What is your organization\'s position on paying ransoms? Who has the authority to make this decision?',
            category: 'decision',
            responseType: 'text',
            guidanceNotes: 'This is a critical policy question. Discuss legal considerations, OFAC sanctions, and organizational values.',
            expectedThemes: ['Ransom policy', 'Decision authority', 'Legal considerations', 'Risk assessment']
          },
          {
            id: 'cisa-ransomware-q-2-3',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 3,
            question: 'How would you maintain business operations with critical systems offline? What manual processes exist?',
            category: 'resource',
            responseType: 'text',
            guidanceNotes: 'Business continuity planning is critical. Discuss manual workarounds, priority systems, and recovery time objectives.',
            expectedThemes: ['Business continuity', 'Manual processes', 'Priority systems', 'Recovery planning']
          },
          {
            id: 'cisa-ransomware-q-2-4',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 4,
            question: 'What are your legal obligations for breach notification? What is your timeline for notifying affected individuals and regulators?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Discuss federal and state notification requirements, timing, and content requirements.',
            expectedThemes: ['Notification requirements', 'Regulatory compliance', 'Legal obligations', 'Timeline management']
          },
          {
            id: 'cisa-ransomware-q-2-5',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 5,
            question: 'How would you coordinate your response to media inquiries? Who is authorized to speak on behalf of the organization?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Crisis communications requires designated spokespersons, approved messaging, and coordination with legal.',
            expectedThemes: ['Media relations', 'Spokesperson designation', 'Message coordination', 'Legal review']
          },
          {
            id: 'cisa-ransomware-q-2-6',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 6,
            question: 'What support would you provide to employees whose personal information was exposed?',
            category: 'resource',
            responseType: 'text',
            guidanceNotes: 'Consider credit monitoring, identity protection services, communication, and emotional support.',
            expectedThemes: ['Employee support', 'Credit monitoring', 'Identity protection', 'Communication']
          },
          {
            id: 'cisa-ransomware-q-2-7',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 7,
            question: 'How would you conduct a lessons learned review after this incident? What changes would you prioritize?',
            category: 'lessons_learned',
            responseType: 'text',
            guidanceNotes: 'Post-incident review should be blameless and focus on systemic improvements.',
            expectedThemes: ['After-action review', 'Root cause analysis', 'Improvement priorities', 'Documentation']
          },
          {
            id: 'cisa-ransomware-q-2-8',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 8,
            question: 'What role should your sector ISAC, CISA, or FBI play in your incident response? How would you engage them?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'External partnerships can provide valuable resources, threat intelligence, and support.',
            expectedThemes: ['External engagement', 'Resource coordination', 'Information sharing', 'Partner relationships']
          },
          {
            id: 'cisa-ransomware-q-2-9',
            createdAt: '2024-09-01T00:00:00Z',
            updatedAt: '2024-09-01T00:00:00Z',
            order: 9,
            question: 'Looking back at the entire scenario, what early warning signs were missed? What could have prevented this attack?',
            category: 'lessons_learned',
            responseType: 'text',
            guidanceNotes: 'Connect the dots from Module 1 to Module 2. Discuss defense in depth and early intervention.',
            expectedThemes: ['Early detection', 'Prevention opportunities', 'Defense in depth', 'Process improvements']
          }
        ]
      }
    ],
    tags: ['ransomware', 'CISA', 'CTEP', 'critical-infrastructure', 'data-exfiltration', 'phishing', 'incident-response']
  }
}
