import type { LibraryEntry } from '../library'

export const cisaSupplyChainScenario: LibraryEntry = {
  id: 'cisa-supply-chain-ctep-001',
  title: 'CISA CTEP: Vendor Supply Chain Compromise',
  category: 'supply_chain',
  difficulty: 'advanced',
  duration: 180,
  description: 'Based on the official CISA Cybersecurity Tabletop Exercise Package (CTEP). This scenario explores a supply chain compromise through a Managed Service Provider (MSP), inspired by real-world incidents like Kaseya and SolarWinds. Organizations must navigate third-party risk management, vendor dependencies, and coordinated incident response.',
  tags: ['supply-chain', 'MSP', 'vendor-risk', 'CISA', 'CTEP', 'third-party', 'C-SCRM', 'critical-infrastructure'],
  moduleCount: 2,
  injectCount: 8,
  questionCount: 19,
  scenario: {
    id: 'cisa-supply-chain-ctep-001',
    title: 'CISA CTEP: Vendor Supply Chain Compromise',
    description: 'Based on the official CISA Cybersecurity Tabletop Exercise Package (CTEP). This scenario explores a supply chain compromise through a Managed Service Provider (MSP), with impacts unfolding over months.',
    version: '1.0.0',
    author: 'Keith',
    createdAt: '2024-08-01T00:00:00Z',
    updatedAt: '2024-08-01T00:00:00Z',
    threatCategory: 'supply_chain',
    difficulty: 'advanced',
    estimatedDuration: 180,
    targetAudience: ['IT Security', 'Vendor Management', 'Executive Leadership', 'Legal/Compliance', 'Procurement', 'Risk Management'],
    objectives: [
      'Examine policies and procedures for managing third-party and supply chain cyber risks',
      'Practice responding to a vendor-originated security incident',
      'Identify gaps in vendor security assessment and monitoring processes',
      'Understand the challenges of supply chain compromise attribution and remediation'
    ],
    facilitatorGuide: {
      id: 'fg-cisa-supply-chain-ctep-001',
      createdAt: '2024-08-01T00:00:00Z',
      updatedAt: '2024-08-01T00:00:00Z',
      title: 'Facilitator Guide - CISA CTEP Supply Chain',
      type: 'facilitator_guide',
      format: 'markdown',
      content: 'This exercise is based on CISA CTEP materials. Module 1 occurs during normal operations and covers vendor risk management. Module 2 jumps forward 6 months to when the compromise is discovered. Emphasize the time delay common in supply chain attacks - the threat actor was present for extended periods before detection.'
    },
    additionalMaterials: [],
    settings: {
      allowParticipantSkip: false,
      requireAllResponses: true,
      showInjectTimestamps: true,
      enableAnonymousResponses: false
    },
    modules: [
      {
        id: 'cisa-supply-chain-mod-1',
        createdAt: '2024-08-01T00:00:00Z',
        updatedAt: '2024-08-01T00:00:00Z',
        title: 'Module 1: Vendor Risk Landscape',
        description: 'Managing vendor relationships and responding to external threat intelligence about supply chain risks.',
        phase: 'pre_incident',
        order: 1,
        suggestedDuration: 90,
        facilitatorNotes: 'This module explores existing vendor risk management processes. Many organizations underestimate their supply chain exposure.',
        injects: [
          {
            id: 'cisa-supply-chain-inj-1-1',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 1,
            title: 'Day 1: Global MSP Incident Reported',
            content: 'News reports indicate a global Managed Service Provider (MSP) suffered a significant cyberattack. The MSP provides IT management services to thousands of organizations worldwide.\n\nThe attack reportedly exploited vulnerabilities in the MSP\'s remote management software, allowing attackers to deploy ransomware to customer networks. Hundreds of organizations are affected across multiple countries.\n\nYour organization does NOT use this specific MSP, but you do rely on an MSP for certain IT services. Leadership is asking questions about your exposure.',
            type: 'information',
            severity: 'medium',
            triggerTime: 0,
            source: 'News Reports / Executive Inquiry',
            facilitatorNotes: 'This inject prompts discussion about supply chain awareness and vendor inventory.',
            expectedActions: ['Verify no direct exposure to affected MSP', 'Review own MSP security practices', 'Brief leadership on current vendor risk posture'],
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-1-1']
          },
          {
            id: 'cisa-supply-chain-inj-1-2',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 2,
            title: 'Day 3: New MSP Contract Consideration',
            content: 'Your organization is evaluating a contract with a new MSP to provide network monitoring and helpdesk services. The MSP offers competitive pricing and promises to reduce IT support costs by 30%.\n\nThe contract terms include:\n- Remote access to your network for monitoring\n- Administrative credentials for troubleshooting\n- Access to endpoint management systems\n- 24/7 monitoring of critical systems\n\nThe procurement team is eager to move forward. The security team has not yet completed their assessment.',
            type: 'decision_point',
            severity: 'medium',
            triggerTime: 15,
            source: 'Procurement / IT',
            facilitatorNotes: 'Discuss vendor security assessments, right to audit clauses, and the tension between business needs and security due diligence.',
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-1-2', 'cisa-supply-chain-q-1-10']
          },
          {
            id: 'cisa-supply-chain-inj-1-3',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 3,
            title: 'Day 7: Sector Partner Data on Dark Web',
            content: 'A sector partner contacts your organization to share threat intelligence. They have discovered data belonging to multiple organizations in your sector posted on a dark web forum.\n\nThe data includes:\n- Internal documents from several organizations\n- Network diagrams and IP addresses\n- Credentials that appear to be for administrative systems\n\nThe common thread appears to be that affected organizations all use the same regional MSP for IT services. This is the same MSP you are currently using for network monitoring.\n\nThe sector partner advises immediate investigation.',
            type: 'escalation',
            severity: 'high',
            triggerTime: 35,
            source: 'Sector Partner / ISAC',
            facilitatorNotes: 'This introduces the possibility that your current MSP may be compromised. Discuss information sharing and partner coordination.',
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-1-4', 'cisa-supply-chain-q-1-8']
          },
          {
            id: 'cisa-supply-chain-inj-1-4',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 4,
            title: 'Day 10: MSP Requests Software Update Authorization',
            content: 'Your MSP contacts the IT team requesting authorization to deploy a software update to the remote management agent installed on your systems. They describe it as a "routine security patch."\n\nThe update request:\n- Requires administrative privileges to deploy\n- Will update the agent on all managed endpoints\n- Includes changes to the agent\'s network communication protocols\n- Is described as "urgent" by the MSP\n\nGiven the recent dark web intelligence, the IT security team is uncertain how to proceed.',
            type: 'decision_point',
            severity: 'critical',
            triggerTime: 55,
            source: 'MSP / IT Security',
            facilitatorNotes: 'Classic supply chain dilemma - legitimate updates vs. potential compromise vector. Discuss verification processes.',
            expectedActions: ['Verify update legitimacy through out-of-band channels', 'Request update documentation and hashes', 'Consider delaying until investigation complete'],
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-1-5', 'cisa-supply-chain-q-1-6']
          }
        ],
        discussionQuestions: [
          {
            id: 'cisa-supply-chain-q-1-1',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 1,
            question: 'Does your organization maintain a comprehensive inventory of third-party vendors with access to your systems or data? How current is this inventory?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Many organizations lack complete visibility into their vendor ecosystem. Discuss vendor inventory processes.',
            expectedThemes: ['Vendor inventory', 'Access management', 'Documentation', 'Regular review']
          },
          {
            id: 'cisa-supply-chain-q-1-2',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 2,
            question: 'What security requirements do you include in vendor contracts? Do you have the right to audit vendor security practices?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Contractual security requirements and audit rights are foundational to vendor risk management.',
            expectedThemes: ['Contract terms', 'Security requirements', 'Audit rights', 'SLA requirements']
          },
          {
            id: 'cisa-supply-chain-q-1-3',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 3,
            question: 'How do you assess and monitor the security posture of your critical vendors on an ongoing basis?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'One-time assessments are insufficient. Discuss continuous monitoring and periodic reassessment.',
            expectedThemes: ['Security assessments', 'Continuous monitoring', 'Risk ratings', 'Reassessment frequency']
          },
          {
            id: 'cisa-supply-chain-q-1-4',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 4,
            question: 'How would you respond to threat intelligence suggesting your MSP may be compromised? What immediate actions would you take?',
            category: 'decision',
            responseType: 'text',
            guidanceNotes: 'Balance is key - don\'t ignore warnings, but don\'t overreact without evidence either.',
            expectedThemes: ['Investigation process', 'Risk assessment', 'Communication with vendor', 'Containment options']
          },
          {
            id: 'cisa-supply-chain-q-1-5',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 5,
            question: 'What is your process for authorizing software updates from vendors? How do you verify the legitimacy of update requests?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Software supply chain attacks often exploit legitimate update mechanisms.',
            expectedThemes: ['Change management', 'Update verification', 'Code signing', 'Testing procedures']
          },
          {
            id: 'cisa-supply-chain-q-1-6',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 6,
            question: 'If you needed to immediately revoke your MSP\'s access to your network, could you do so? What would the business impact be?',
            category: 'resource',
            responseType: 'text',
            guidanceNotes: 'Discuss "kill switch" capabilities and business continuity if vendor access is revoked.',
            expectedThemes: ['Access revocation', 'Business continuity', 'Alternative capabilities', 'Recovery time']
          },
          {
            id: 'cisa-supply-chain-q-1-7',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 7,
            question: 'How do you balance the need for vendor access with the principle of least privilege? What access controls are in place?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Vendors often have more access than necessary. Discuss segmentation and access controls.',
            expectedThemes: ['Least privilege', 'Network segmentation', 'Access controls', 'Monitoring']
          },
          {
            id: 'cisa-supply-chain-q-1-8',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 8,
            question: 'What role does threat intelligence sharing with sector partners play in your security program? How would you act on shared intelligence?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'Sector partnerships and ISACs provide valuable early warning capabilities.',
            expectedThemes: ['Information sharing', 'ISAC membership', 'Partner coordination', 'Intelligence action']
          },
          {
            id: 'cisa-supply-chain-q-1-9',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 9,
            question: 'How would you communicate with executive leadership about supply chain risks? What information would they need to make decisions?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Supply chain risk is often not well understood at executive levels.',
            expectedThemes: ['Executive communication', 'Risk articulation', 'Decision support', 'Business context']
          },
          {
            id: 'cisa-supply-chain-q-1-10',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 10,
            question: 'What due diligence would you require before approving a new MSP contract? How would you assess their security maturity?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Pre-contract due diligence sets the foundation for the vendor relationship.',
            expectedThemes: ['Due diligence', 'Security assessment', 'Reference checks', 'Certification requirements']
          }
        ]
      },
      {
        id: 'cisa-supply-chain-mod-2',
        createdAt: '2024-08-01T00:00:00Z',
        updatedAt: '2024-08-01T00:00:00Z',
        title: 'Module 2: Compromise Discovery (6 Months Later)',
        description: 'Six months after Module 1, a supply chain compromise is confirmed and your organization must respond.',
        phase: 'detection',
        order: 2,
        suggestedDuration: 90,
        facilitatorNotes: 'This module jumps forward in time. The MSP was compromised, and malware has been dormant in your environment. Emphasize the extended dwell time common in sophisticated attacks.',
        injects: [
          {
            id: 'cisa-supply-chain-inj-2-1',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 1,
            title: 'Day 182: Network Access Issues',
            content: 'Multiple employees report intermittent issues accessing network resources. The problems are inconsistent:\n\n- Some users cannot authenticate to internal applications\n- VPN connections are dropping unexpectedly\n- File server access is slow or failing\n- Help desk tickets spike by 400%\n\nIT support contacts the MSP, but the MSP\'s support line is not answering. Their website displays a message: "We are experiencing technical difficulties. Please check back later."',
            type: 'information',
            severity: 'high',
            triggerTime: 0,
            source: 'IT Help Desk',
            facilitatorNotes: 'The symptoms are vague but concerning. The MSP\'s unavailability is a red flag.',
            attachments: [],
            relatedQuestionIds: []
          },
          {
            id: 'cisa-supply-chain-inj-2-2',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 2,
            title: 'Day 183: MSP Breach Confirmed',
            content: 'A major cybersecurity company releases a public report: Your MSP suffered a significant breach 7 months ago. Threat actors compromised the MSP\'s software development environment and inserted malware into the remote management agent distributed to all customers.\n\nKey findings:\n- Malware was dormant for months before activating\n- Affected organizations number in the hundreds\n- The malware provides persistent backdoor access\n- Data exfiltration occurred in many victim environments\n- Your organization is listed among affected customers\n\nThe MSP has filed for bankruptcy protection.',
            type: 'escalation',
            severity: 'critical',
            triggerTime: 15,
            source: 'Cybersecurity News / Legal',
            facilitatorNotes: 'The scope is now clear. Your organization has been compromised through a trusted third party.',
            expectedActions: ['Isolate systems with MSP agent installed', 'Begin forensic investigation', 'Engage legal and executive leadership', 'Activate incident response plan'],
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-2-1', 'cisa-supply-chain-q-2-4']
          },
          {
            id: 'cisa-supply-chain-inj-2-3',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 3,
            title: 'Day 184: Internal Investigation Findings',
            content: 'Your incident response team completes initial forensic analysis:\n\n- The malicious MSP agent was installed on 78 systems including domain controllers\n- Network traffic analysis shows suspicious outbound connections over 7 months\n- Approximately 150GB of data was exfiltrated to unknown external IPs\n- The backdoor provided administrative access to your Active Directory\n- Evidence suggests credential harvesting occurred\n\nThe full scope of compromised data is still being determined. Business operations are significantly impacted.',
            type: 'information',
            severity: 'critical',
            triggerTime: 35,
            source: 'Incident Response Team',
            facilitatorNotes: 'The compromise is extensive. Domain controllers affected means full network compromise is possible.',
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-2-2', 'cisa-supply-chain-q-2-3']
          },
          {
            id: 'cisa-supply-chain-inj-2-4',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 4,
            title: 'Day 185: Regulatory and Legal Concerns',
            content: 'Your legal team provides a briefing on implications:\n\n- Multiple state data breach notification laws may apply\n- Regulatory bodies in your sector are requesting information\n- The bankrupt MSP cannot provide assistance or indemnification\n- Cyber insurance coverage for supply chain incidents is unclear\n- Class action lawsuits have been filed against other affected organizations\n\nThe Board of Directors has scheduled an emergency meeting and wants a full briefing on exposure, response, and recovery timeline.',
            type: 'information',
            severity: 'high',
            triggerTime: 50,
            source: 'Legal / Compliance',
            facilitatorNotes: 'Legal and regulatory complexity adds pressure. The MSP\'s bankruptcy complicates recovery.',
            attachments: [],
            relatedQuestionIds: ['cisa-supply-chain-q-2-5', 'cisa-supply-chain-q-2-8']
          }
        ],
        discussionQuestions: [
          {
            id: 'cisa-supply-chain-q-2-1',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 1,
            question: 'Given that the compromise occurred through a trusted vendor\'s software, how would you approach containment differently than a traditional intrusion?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Supply chain compromises affect trusted software - traditional containment approaches may need adaptation.',
            expectedThemes: ['Trusted software risks', 'Containment strategy', 'Agent removal', 'Network isolation']
          },
          {
            id: 'cisa-supply-chain-q-2-2',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 2,
            question: 'With domain controllers potentially compromised, what is your approach to Active Directory recovery? Do you have known-good backups?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'AD compromise may require forest recovery - a complex and time-consuming process.',
            expectedThemes: ['AD recovery', 'Backup integrity', 'Credential reset', 'Forest recovery']
          },
          {
            id: 'cisa-supply-chain-q-2-3',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 3,
            question: 'How would you determine what data was exfiltrated over 7 months when the attacker had administrative access?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Scope determination is extremely difficult with long dwell times and admin access.',
            expectedThemes: ['Data classification', 'Log analysis', 'Forensic investigation', 'Scope estimation']
          },
          {
            id: 'cisa-supply-chain-q-2-4',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 4,
            question: 'Your MSP has gone bankrupt. How do you maintain IT operations while responding to the incident? What alternatives exist?',
            category: 'resource',
            responseType: 'text',
            guidanceNotes: 'Business continuity when a key vendor fails is a critical challenge.',
            expectedThemes: ['Business continuity', 'Alternative vendors', 'Internal capability', 'Priority services']
          },
          {
            id: 'cisa-supply-chain-q-2-5',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 5,
            question: 'What would you present to the Board of Directors? How would you communicate the severity while demonstrating a path forward?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Board communication requires balancing transparency with reassurance about response.',
            expectedThemes: ['Board communication', 'Executive briefing', 'Risk articulation', 'Recovery roadmap']
          },
          {
            id: 'cisa-supply-chain-q-2-6',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 6,
            question: 'How would you coordinate with other affected organizations and share threat intelligence about this incident?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'Multi-victim incidents benefit from coordinated response and shared intelligence.',
            expectedThemes: ['Victim coordination', 'Intelligence sharing', 'Joint investigation', 'ISAC engagement']
          },
          {
            id: 'cisa-supply-chain-q-2-7',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 7,
            question: 'What changes would you make to your vendor risk management program based on this experience?',
            category: 'lessons_learned',
            responseType: 'text',
            guidanceNotes: 'This incident exposes gaps in third-party risk management that should be addressed.',
            expectedThemes: ['Vendor risk management', 'Assessment improvements', 'Monitoring enhancements', 'Contract changes']
          },
          {
            id: 'cisa-supply-chain-q-2-8',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 8,
            question: 'How would you rebuild trust with customers, partners, and employees following this breach?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Reputation recovery is a long-term effort requiring transparency and demonstrated improvement.',
            expectedThemes: ['Stakeholder communication', 'Transparency', 'Trust rebuilding', 'Demonstrated improvement']
          },
          {
            id: 'cisa-supply-chain-q-2-9',
            createdAt: '2024-08-01T00:00:00Z',
            updatedAt: '2024-08-01T00:00:00Z',
            order: 9,
            question: 'What preventive measures could have detected or limited the impact of this supply chain compromise?',
            category: 'lessons_learned',
            responseType: 'text',
            guidanceNotes: 'Discuss defense-in-depth approaches that could limit supply chain attack impact.',
            expectedThemes: ['Prevention measures', 'Detection capabilities', 'Segmentation', 'Least privilege']
          }
        ]
      }
    ],
    tags: ['supply-chain', 'MSP', 'vendor-risk', 'CISA', 'CTEP', 'third-party', 'C-SCRM', 'critical-infrastructure']
  }
}
